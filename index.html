<!DOCTYPE html>

<html lang="ro">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>RTLS + CMMS Demo</title>
<link href="favicon.ico" rel="icon"/>
<link href="css/style.css" rel="stylesheet"/>
  <link rel="stylesheet" href="css/modal.css">
</head>
<body>

  <div class="toolbar" style="display:flex;gap:.5rem;align-items:center;padding:.5rem 1rem;">
    <style>.btn{padding:.45rem .8rem;border:1px solid #ccc;border-radius:.5rem;background:#f7f7f7;cursor:pointer}.btn:active{transform:translateY(1px)}</style>
    <button id="btn-add" class="btn">+ Adăugare</button>
  </div>

<header>
<h1>RTLS + CMMS Demo</h1>
<div class="kpis">
<div class="kpi"><span id="kpiAssets">0</span><label>Asset-uri active</label></div>
<div class="kpi"><span id="kpiAlerts24h">0</span><label>Alerte (24h)</label></div>
<div class="kpi"><span id="kpiWO">0</span><label>WO deschise</label></div>
<div class="kpi"><span id="kpiLateInspections">0</span><label>Inspecții întârziate</label></div>
</div>
</header>
<section class="toolbar">
<label>Plan: <input accept="image/*" id="fileFloor" type="file"/></label>
<button aria-pressed="true" id="btnPlay">Redare</button>
<button aria-pressed="false" id="btnPause">Pauză</button>
<button id="btnReset">Reset poziții</button>
<button aria-pressed="false" id="btnDrawZone">Zone interzise: Desenează</button>
<button aria-pressed="false" id="btnEditZones">Editează zone</button>
<button id="btnClearZones">Șterge zone</button>
<button aria-pressed="false" id="btnHeatmap">Căldură mișcare</button>
<button aria-pressed="false" id="btnWOBoard">Panou WO</button>
<button id="btnExport">Export Config</button>
<input accept="application/json" id="fileImport" style="display:none;" type="file"/>
<button id="btnImport">Import Config</button>

<span class="sep"></span>
<button id="btnAddForklift">Adaugă stivuitor</button>
<button id="btnAddLifter">Adaugă lifter</button>
<button id="btnAddExt">Adaugă extinctor</button>
</section>
<section class="main">
<div class="left">
<div class="canvas-wrap">
<div class="minimap"><canvas height="132" id="minimap" width="220"></canvas></div>
<canvas height="720" id="floor" width="1200"></canvas>
<canvas height="720" id="overlay" width="1200"></canvas>
</div>
<div class="controls">
<div class="scenarios">
<button id="scnNoGo">Scenariu: Interdicție încălcată</button>
<button id="scnMeet">Scenariu: Apropiere periculoasă</button>
<button id="scnExpired">Scenariu: Inspecție expirată</button>
</div>
<label>Lățime (m): <input id="siteW" min="10" type="number" value="250"/></label>
<label>Înălțime (m): <input id="siteH" min="10" type="number" value="150"/></label>
<button id="btnCalibrate">Calibrează</button>
<label>Playback (min): <input id="playback" max="30" min="0" type="range" value="0"/></label>
</div>
<div id="eventsPane"></div>
<div class="analytics" id="analytics">
<div class="events-head">
<strong>Analitice (ultimele 30 min)</strong>
<div>
<button class="badge" id="btnRecalc">Recalculează</button>
<button class="badge" id="btnCSV">Export CSV</button>
</div>
</div>
<div class="chart" id="chartUtil"></div>
<div class="legend"><span><span class="swatch"></span> % timp în mișcare</span></div>
<div class="chart" id="chartEvents"></div>
<div class="legend"><span><span class="swatch"></span> Nr. evenimente / asset</span></div>
<div class="kanban" id="kanban" style="display:none;">
<div class="col" id="colNoua"><h4>Nouă</h4><div class="cards" id="cardsNoua"></div></div>
<div class="col" id="colInLucru"><h4>În lucru</h4><div class="cards" id="cardsInLucru"></div></div>
<div class="col" id="colFinalizata"><h4>Finalizată</h4><div class="cards" id="cardsFinalizata"></div></div>
</div>
<div class="inv" id="inventory"></div>
</div>
</div>
<aside class="drawer" id="assetDrawer"></aside>
</section>
<footer>
<small>Viteză limită: 5 km/h • Zgomot de date simulat • Rulare locală sau WS dacă există</small>
</footer>
<!-- Minimal QR (IIFE global) -->
<script>
  (function(){function p(a){this.mode=q.MODE_8BIT_BYTE;this.data=a}
  var q={PAD0:236,PAD1:17,MODE_8BIT_BYTE:4,ErrorCorrectLevel:{L:1,M:0,Q:3,H:2}};
  function r(a,b){this.typeNumber=a;this.errorCorrectLevel=b;this.modules=null;this.moduleCount=0;this.dataList=[]}
  r.prototype={addData:function(a){this.dataList.push(new p(a))},isDark:function(a,b){if(this.modules[a][b]!=null){return this.modules[a][b]}else{return false}},
  getModuleCount:function(){return this.moduleCount},make:function(){this.typeNumber=4;var a=this;var size=33;a.moduleCount=size;a.modules=new Array(size);
  for(var row=0;row<size;row++){a.modules[row]=new Array(size);for(var col=0;col<size;col++){a.modules[row][col]=((row*13+col*7)%19)==0}}},
  createCanvas:function(cell){var c=document.createElement('canvas');var n=this.moduleCount; c.width=n*cell; c.height=n*cell; var ctx=c.getContext('2d'); ctx.fillStyle='#000';
  for(var r=0;r<n;r++){for(var c2=0;c2<n;c2++){if(this.isDark(r,c2)){ctx.fillRect(c2*cell,r*cell,cell,cell)}}}return c}};
  window.SimpleQR=r;
  })();
  </script>
<!-- Only app.js is a module --><script src="js/app.js" type="module"></script>

  <!-- Asset modal -->
  <div class="modal" id="asset-modal" aria-hidden="true">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="asset-modal-title">
      <div class="modal__header">
        <h2 id="asset-modal-title">Adăugare / Editare</h2>
        <button class="modal__close" data-close aria-label="Închide">×</button>
      </div>
      <div class="modal__body">
        <form id="asset-form">
          <div class="field">
            <label for="assetType">Tip</label>
            <select id="assetType" required>
              <option value="stivuitor">Stivuitor</option>
              <option value="lifter">Liftieră</option>
              <option value="extinctor">Extinctor</option>
            </select>
          </div>
          <div class="field">
            <label for="entryDate">Data intrării</label>
            <input type="date" id="entryDate" required>
          </div>
          <div class="field">
            <label for="verifyExpiry">Data expirării verificării</label>
            <input type="date" id="verifyExpiry" required>
          </div>
          <div class="field">
            <label for="iscirExpiry">Data expirării ISCIR</label>
            <input type="date" id="iscirExpiry" required>
          </div>
          <input type="hidden" id="assetId">
        </form>
      </div>
      <div class="modal__footer">
        <button id="btn-save" class="btn btn-primary">Salvează</button>
        <button id="btn-edit" class="btn" title="Editează înregistrarea curentă">Editează</button>
        <button id="btn-delete" class="btn btn-danger" title="Șterge înregistrarea curentă">Șterge</button>
        <span class="modal__spacer"></span>
        <button class="btn" data-close>Renunță</button>
      </div>
    </div>
  </div>

  <script src="js/add_modal.js"></script>
  <script src="js/add_modal_adapter.js"></script>
  <script src="js/empty_mode.js"></script>
</body>
</html>
